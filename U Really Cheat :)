-- Load Rayfield UI Library dengan Perlindungan Bypass
local success, Rayfield = pcall(function()
    return loadstring(game:HttpGet('https://raw.githubusercontent.com/shlexware/Rayfield/main/source'))()
end)

if not success or not Rayfield then
    warn("Gagal memuat Rayfield UI! Periksa koneksi atau coba lagi.")
    return
end

-- Key System Configuration
local Key = "Ramadhan2025"
local Verified = false
local AutoReapply = {}

-- Auto Recovery System
local function AutoRecovery()
    while task.wait(5) do
        for name, func in pairs(AutoReapply) do
            if not func() then
                func()
            end
        end
    end
end
task.spawn(AutoRecovery)

-- Auto-Reapply saat respawn
local function AutoReapplyFeatures()
    if not game.Players.LocalPlayer.Character then return end
    task.wait(1)
    for _, func in pairs(AutoReapply) do
        task.spawn(func)
    end
end
game.Players.LocalPlayer.CharacterAdded:Connect(AutoReapplyFeatures)

-- **Bypass Anti-Cheat (Diperbaiki)**
local function BypassAntiCheat()
    local character = game.Players.LocalPlayer.Character
    if not character then return end

    for _, v in pairs({"Humanoid", "HumanoidRootPart", "LocalScript", "ModuleScript"}) do
        local success, err = pcall(function()
            if character:FindFirstChild(v) then
                character[v].Archivable = true
            end
        end)
        if not success then
            warn("Bypass gagal pada:", v, err)
        end
    end
end
task.spawn(BypassAntiCheat)

-- **Function untuk Load UI utama**
function LoadMainUI()
    local MainWindow = Rayfield:CreateWindow({
        Name = "ZDZ Hub",
        LoadingTitle = "LoadScript...",
        LoadingSubtitle = "V3.0",
        ConfigurationSaving = { Enabled = true, FolderName = "ZDZHub", FileName = "Config" }
    })

    -- **Tab KeySystem**
    local KeyTab = MainWindow:CreateTab("KeySystem")
    local KeyInput = KeyTab:CreateInput({
        Name = "Enter Key",
        Callback = function(value)
            if value == Key then
                Verified = true
                Rayfield:Notify({ Title = "Success", Content = "Key Verified!", Duration = 3 })
                task.wait(1)
                KeyTab:Destroy()
                LoadMainUI()
            else
                Rayfield:Notify({ Title = "Failed", Content = "Wrong Key!", Duration = 3 })
            end
        end
    })

    -- **Tab Info**
    local InfoTab = MainWindow:CreateTab("Info")
    InfoTab:CreateParagraph({ Title = "ZDZ Hub", Content = "This Script Made By Aan" })
    InfoTab:CreateParagraph({ Title = "Release", Content = "This Script Has Released In March 5th, 2025 (Ramadhan Event)" })

    -- **Tab Main**
    local MainTab = MainWindow:CreateTab("Main")

    -- **Fly System (Diperbaiki)**
    local FlyEnabled = false
    local FlySpeed = 50

    local function EnableFly()
        local plr = game.Players.LocalPlayer
        local char = plr.Character or plr.CharacterAdded:Wait()
        local hrp = char:FindFirstChild("HumanoidRootPart")
        if not hrp then return false end

        local BodyVelocity = Instance.new("BodyVelocity", hrp)
        BodyVelocity.Velocity = Vector3.zero
        BodyVelocity.MaxForce = Vector3.new(4000, 4000, 4000)

        local connection
        connection = game:GetService("RunService").RenderStepped:Connect(function()
            if FlyEnabled then
                local moveDirection = game.Players.LocalPlayer:GetMouse().Hit.p - hrp.Position
                BodyVelocity.Velocity = moveDirection.unit * FlySpeed
            else
                BodyVelocity:Destroy()
                connection:Disconnect()
            end
        end)

        return true
    end

    MainTab:CreateToggle({
        Name = "Fly (Bypass Anti-Cheat)",
        Callback = function(state)
            FlyEnabled = state
            if state then
                AutoReapply["Fly"] = EnableFly
                EnableFly()
            else
                AutoReapply["Fly"] = nil
            end
        end
    })

    MainTab:CreateSlider({
        Name = "Fly Speed",
        Min = 0,
        Max = 100,
        Default = 50,
        Callback = function(value)
            FlySpeed = value
        end
    })

    -- **ESP System (Diperbaiki)**
    local function EnableESP(target)
        task.spawn(function()
            while task.wait(2) do
                for _, player in pairs(game.Players:GetPlayers()) do
                    if player.Character then
                        if not target or player.Name == target then
                            if not player.Character:FindFirstChild("Highlight") then
                                local Highlight = Instance.new("Highlight", player.Character)
                                Highlight.FillColor = (player.Team ~= game.Players.LocalPlayer.Team) and Color3.fromRGB(255, 0, 0) or Color3.fromRGB(0, 255, 0)
                                Highlight.Parent = player.Character
                            end
                        else
                            for _, v in pairs(player.Character:GetChildren()) do
                                if v:IsA("Highlight") then v:Destroy() end
                            end
                        end
                    end
                end
            end
        end)
    end

    MainTab:CreateToggle({
        Name = "ESP (Auto-Reapply)",
        Callback = function(state)
            EnableESP(state)
            if state then
                AutoReapply["ESP"] = function() return EnableESP() end
            else
                AutoReapply["ESP"] = nil
            end
        end
    })

    -- **Tab Misc**
    local MiscTab = MainWindow:CreateTab("Misc")

    MiscTab:CreateToggle({
        Name = "Anti Fog",
        Callback = function(state)
            game.Lighting.FogEnd = state and 100000 or 1000
        end
    })

    MiscTab:CreateToggle({
        Name = "Anti Lag",
        Callback = function(state)
            game.Lighting.GlobalShadows = not state
        end
    })

    MiscTab:CreateToggle({
        Name = "FullBright",
        Callback = function(state)
            game.Lighting.Brightness = state and 5 or 1
        end
    })

    MiscTab:CreateToggle({
        Name = "Toggle FPS Boost",
        Callback = function(state)
            setfpscap(state and 999 or 60)
        end
    })

    -- **Select Theme**
    local Themes = { "Default", "Ocean", "Amber Glow", "Amethyst", "Light", "Dark", "Super Dark" }
    local SelectedTheme = "Default"

    MiscTab:CreateDropdown({
        Name = "Select Theme",
        Options = Themes,
        Callback = function(value)
            SelectedTheme = value
        end
    })

    MiscTab:CreateButton({
        Name = "Apply Theme",
        Callback = function()
            Rayfield:SetTheme(SelectedTheme)
        end
    })

    Rayfield:LoadConfiguration()
end

LoadMainUI()
