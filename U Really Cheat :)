local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

local Players = game:GetService("Players")
local Lighting = game:GetService("Lighting")
local StarterGui = game:GetService("StarterGui")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")

local player = Players.LocalPlayer
local CorrectKey = "Ramadhan2025"
local KeyVerified = false

-- üîë **Key System**
local KeyWindow = Rayfield:CreateWindow({
    Name = "Key System",
    LoadingTitle = "Verifying...",
    LoadingSubtitle = "Enter the key to continue",
    Theme = "Light"
})

local KeyTab = KeyWindow:CreateTab("Key Verification")
KeyTab:CreateParagraph({Title = "Tips", Content = "Free Key --> [Ramadhan2025]"})

local function verifyKey(Input)
    if Input == CorrectKey then
        KeyVerified = true
        Rayfield:Notify({Title = "‚úÖ Correct Key!", Content = "Welcome to ZDZ Hub!"})

        task.wait(0.5)

        -- ‚úÖ **Hapus Key Window dengan Aman**
        pcall(function()
            if KeyWindow then
                KeyWindow:Destroy()
            end
        end)

        loadMainUI() -- **Memuat UI utama setelah key diverifikasi**
    else
        Rayfield:Notify({Title = "‚ùå Incorrect Key!", Content = "Please try again!"})
    end
end

KeyTab:CreateInput({
    Name = "Enter Key",
    PlaceholderText = "Type your key here...",
    RemoveTextAfterFocusLost = false,
    Callback = function(Input)
        verifyKey(Input)
    end
})

-- üöÄ **Function to Load Main UI After Key Verification**
function loadMainUI()
    if not KeyVerified then return end -- ‚úÖ Pastikan Key sudah diverifikasi

    local Window = Rayfield:CreateWindow({
        Name = "ZDZ Hub",
        LoadingTitle = "Loading...",
        LoadingSubtitle = "by Aan",
        Theme = "Light"
    })

    -- **Buat Tab**
    local TabInfo = Window:CreateTab("Info", 1510045894)
    local TabMain = Window:CreateTab("Main", 4483362458)
    local TabMisc = Window:CreateTab("Misc", 1510045894)
    local TabScript = Window:CreateTab("Script", 1510045894)
    local TabTheme = Window:CreateTab("Theme", 1510045894) -- ‚úÖ **Theme Selector Tidak Terpotong**

    -- üé® **Theme Selector**
    local Colors = {
        "Red", "Blue", "Green", "Yellow", "Purple", "Orange", "Cyan", "Magenta",
        "Black & White", "Gradient Red-Blue", "Gradient Green-Yellow"
    }

    local SelectedTheme = "Light"

    TabTheme:CreateDropdown({
        Name = "Select Theme Color",
        Options = Colors,
        Callback = function(Selected)
            SelectedTheme = Selected
        end
    })

    TabTheme:CreateButton({
        Name = "Apply Theme",
        Callback = function()
            Rayfield:SetTheme(SelectedTheme)
            Rayfield:Notify({Title = "üé® Theme Applied!", Content = "New theme: " .. SelectedTheme})
        end
    })

    -- üîÑ **Auto-Reapply After Respawn**
    player.CharacterAdded:Connect(function()
        task.wait(1)
        pcall(optimizeFPS)
        pcall(bypassAntiCheat)
    end)

    -- ‚úÖ Jalankan Sistem
    pcall(optimizeFPS)
    pcall(bypassAntiCheat)
    pcall(detectKickBan)

    -- üîç **Bypass Anti-Cheat Advanced**
    RunService.Stepped:Connect(function()
        local character = player.Character
        if character then
            local humanoid = character:FindFirstChildWhichIsA("Humanoid")
            if humanoid then
                humanoid:SetStateEnabled(Enum.HumanoidStateType.Seated, false)
                humanoid:SetStateEnabled(Enum.HumanoidStateType.FallingDown, false)
                humanoid:SetStateEnabled(Enum.HumanoidStateType.Ragdoll, false)

                humanoid.WalkSpeed = math.min(humanoid.WalkSpeed, 16)
                humanoid.JumpPower = math.min(humanoid.JumpPower, 50)
            end
        end
    end)

    -- üõ°Ô∏è **Anti-Cheat Protection**
    task.spawn(function()
        local success, mt = pcall(getrawmetatable, game)
        if success and mt then
            setreadonly(mt, false)

            local oldIndex = mt.__index
            mt.__index = newcclosure(function(self, key)
                if key == "WalkSpeed" or key == "JumpPower" then
                    return 16
                end
                return oldIndex(self, key)
            end)

            local oldNamecall = mt.__namecall
            mt.__namecall = newcclosure(function(self, ...)
                local method = getnamecallmethod()
                if method == "Kick" or method == "Destroy" then
                    return nil
                end
                return oldNamecall(self, ...)
            end)
        end
    end)

    -- üöÄ **FPS Booster**
    function optimizeFPS()
        for _, v in ipairs(workspace:GetDescendants()) do
            if v:IsA("BasePart") and not v:IsDescendantOf(player.Character) then
                v.Material = Enum.Material.SmoothPlastic
                v.Reflectance = 0
            elseif v:IsA("ParticleEmitter") or v:IsA("Trail") then
                v.Enabled = false
            elseif v:IsA("Explosion") then
                v:Destroy()
            end
        end
        Lighting.FogEnd = 1e6
        Lighting.FogStart = 1e6
        Lighting.GlobalShadows = false
    end

    -- üîÑ **Bypass Kick/Ban Detection**
    function detectKickBan()
        StarterGui:SetCore("ResetButtonCallback", false)
    end

    -- **Teleport Toggle dengan Anti TP Kembali**
    local TeleportEnabled = false

    local function ToggleTeleport()
        TeleportEnabled = not TeleportEnabled
        Rayfield:Notify({
            Title = TeleportEnabled and "‚úÖ Teleport Enabled" or "‚ùå Teleport Disabled",
            Content = "Click anywhere to teleport"
        })
    end

    TabMain:CreateToggle({ Name = "Teleport", Callback = ToggleTeleport })

    -- üî• **Teleport Sesuai Klik**
    UserInputService.InputBegan:Connect(function(input, gameProcessed)
        if gameProcessed then return end
        if TeleportEnabled and input.UserInputType == Enum.UserInputType.MouseButton1 then
            local mouse = player:GetMouse()
            if mouse and mouse.Target and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
                local pos = mouse.Hit.p
                player.Character.HumanoidRootPart.CFrame = CFrame.new(pos)
            end
        end
    end)
end

-- // ‚úÖ ESP Lengkap dengan Auto Refresh & Event System
local ESPEnabled = false
local ESPColor = Color3.fromRGB(255, 0, 0)
local ESPObjects = {}

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")
local LocalPlayer = Players.LocalPlayer
local Character = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
local HRP = Character:FindFirstChild("HumanoidRootPart") or Character:WaitForChild("HumanoidRootPart")

local LastPosition = HRP.Position
local TeleportThreshold = 10
local TweenInfoSettings = TweenInfo.new(0.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)

-- ‚úÖ **Buat ESP dengan Sistem Optimal**
local function CreateESP(obj, isPlayer)
    if not obj or not obj:IsA("BasePart") or obj:FindFirstChild("ESP") then return end

    local Billboard = Instance.new("BillboardGui")
    Billboard.Name = "ESP"
    Billboard.Size = UDim2.new(0, 100, 0, 40)
    Billboard.AlwaysOnTop = true
    Billboard.Adornee = obj
    Billboard.ResetOnSpawn = false
    Billboard.Parent = obj

    local Label = Instance.new("TextLabel")
    Label.Size = UDim2.new(1, 0, 1, 0)
    Label.BackgroundTransparency = 1
    Label.TextColor3 = ESPColor
    Label.TextStrokeTransparency = 0.5
    Label.TextScaled = true
    Label.Font = Enum.Font.SourceSansBold
    Label.Text = isPlayer and obj.Parent.Name or obj.Name
    Label.Parent = Billboard

    ESPObjects[obj] = Billboard

    -- üîÑ **Auto-Update ESP dengan Smooth**
    task.spawn(function()
        while ESPEnabled and obj and obj.Parent and HRP do
            task.wait(0.1) -- ‚è≥ **Lebih optimal & cepat**
            local Distance = (obj.Position - HRP.Position).Magnitude
            Label.Text = isPlayer and obj.Parent.Name or (obj.Name .. " (" .. math.floor(Distance) .. "m)")
        end
        if Billboard then Billboard:Destroy() end
    end)
end

-- üîÑ **Update ESP Secara Otomatis**
local function UpdateESP()
    -- ‚ùå **Hapus semua ESP lama dengan aman**
    for obj, gui in pairs(ESPObjects) do
        if gui and gui.Parent then gui:Destroy() end
    end
    ESPObjects = {}

    if ESPEnabled then
        for _, v in ipairs(Players:GetPlayers()) do
            if v ~= LocalPlayer and v.Character then
                local Head = v.Character:FindFirstChild("HumanoidRootPart") or v.Character:FindFirstChild("Head")
                if Head then CreateESP(Head, true) end
            end
        end
        for _, obj in ipairs(workspace:GetDescendants()) do
            if obj:IsA("Model") and obj:FindFirstChildWhichIsA("BasePart") then
                CreateESP(obj:FindFirstChildWhichIsA("BasePart"), false)
            end
        end
    end
end

-- üîò **Toggle ESP**
TabMain:CreateToggle({
    Name = "ESP",
    Callback = function(state)
        ESPEnabled = state
        UpdateESP()
    end
})

-- üé® **Warna ESP Selector**
TabMain:CreateDropdown({
    Name = "ESP Warna",
    Options = { "Merah", "Hijau", "Biru" },
    Callback = function(value)
        ESPColor = value == "Merah" and Color3.fromRGB(255, 0, 0) or
                   value == "Hijau" and Color3.fromRGB(0, 255, 0) or
                   Color3.fromRGB(0, 0, 255)

        -- üîÑ **Perbarui warna ESP langsung**
        for _, gui in pairs(ESPObjects) do
            local label = gui:FindFirstChildOfClass("TextLabel")
            if label then label.TextColor3 = ESPColor end
        end
    end
})

-- üîÑ **Auto Refresh ESP Saat Pemain Masuk/Keluar**
Players.PlayerAdded:Connect(UpdateESP)
Players.PlayerRemoving:Connect(UpdateESP)

-- // üõ°Ô∏è **Anti TP Kembali dengan Smooth Tweening**
RunService.Stepped:Connect(function()
    if not HRP or not Character then return end
    local Distance = (HRP.Position - LastPosition).Magnitude

    -- ‚úÖ **Deteksi teleportasi ilegal dengan cepat**
    if Distance > TeleportThreshold then
        local Tween = TweenService:Create(HRP, TweenInfoSettings, { Position = LastPosition })
        Tween:Play()
    else
        LastPosition = HRP.Position
    end
end)

-- üîÑ **Handle Respawn agar Tidak Bug**
LocalPlayer.CharacterAdded:Connect(function(NewCharacter)
    task.wait(1)
    Character = NewCharacter
    HRP = Character:FindFirstChild("HumanoidRootPart") or Character:WaitForChild("HumanoidRootPart")
    LastPosition = HRP.Position
end)

Rayfield:Notify({
    Title = "‚úÖ Script Loaded!",
    Content = "ESP & Anti TP Kembali telah dioptimalkan!",
    Duration = 5
})


local InfiniteJump = false
local FlyEnabled = false
local FlySpeed = 50
local DefaultWalkSpeed = 16
local DefaultJumpPower = 50
local FlingPower = 100000
local GravityValue = workspace.Gravity
local BodyVelocity, BodyGyro, FlingPart
local FlyConnection

local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local LocalPlayer = game:GetService("Players").LocalPlayer

-- // Pastikan TabMisc ada
if not TabMisc then
    warn("‚ö†Ô∏è TabMisc belum dibuat! Membuat TabMisc...")
    TabMisc = Window:CreateTab("Misc")
end

-- // ‚úÖ Infinite Jump lebih stabil
local function EnableInfiniteJump()
    UserInputService.JumpRequest:Connect(function()
        if InfiniteJump then
            local Character = LocalPlayer.Character
            if Character then
                local Humanoid = Character:FindFirstChildOfClass("Humanoid")
                if Humanoid then
                    Humanoid:ChangeState(Enum.HumanoidStateType.Jumping)
                end
            end
        end
    end)
end

TabMisc:CreateToggle({
    Name = "Infinite Jump",
    CurrentValue = false,
    Callback = function(Value)
        InfiniteJump = Value
    end
})

LocalPlayer.CharacterAdded:Connect(function()
    task.wait(1)
    EnableInfiniteJump()
end)

-- // ‚úÖ Fly lebih smooth & responsif
local function StopFly()
    if FlyConnection then FlyConnection:Disconnect() FlyConnection = nil end
    if BodyVelocity then BodyVelocity:Destroy() BodyVelocity = nil end
    if BodyGyro then BodyGyro:Destroy() BodyGyro = nil end
end

TabMisc:CreateToggle({
    Name = "Fly",
    CurrentValue = false,
    Callback = function(Value)
        FlyEnabled = Value
        local Character = LocalPlayer.Character
        if not Character then return end
        
        local HumanoidRootPart = Character:FindFirstChild("HumanoidRootPart")
        if not HumanoidRootPart then return end

        if FlyEnabled then
            BodyVelocity = Instance.new("BodyVelocity", HumanoidRootPart)
            BodyVelocity.Velocity = Vector3.zero
            BodyVelocity.MaxForce = Vector3.new(math.huge, math.huge, math.huge)

            BodyGyro = Instance.new("BodyGyro", HumanoidRootPart)
            BodyGyro.CFrame = workspace.CurrentCamera.CFrame
            BodyGyro.MaxTorque = Vector3.new(math.huge, math.huge, math.huge)

            FlyConnection = RunService.Heartbeat:Connect(function()
                if FlyEnabled and HumanoidRootPart then
                    BodyVelocity.Velocity = workspace.CurrentCamera.CFrame.LookVector * FlySpeed
                    BodyGyro.CFrame = workspace.CurrentCamera.CFrame
                else
                    StopFly()
                end
            end)
        else
            StopFly()
        end
    end
})

TabMisc:CreateSlider({
    Name = "Fly Speed",
    Range = {0, 200},
    Increment = 1,
    CurrentValue = 50,
    Callback = function(Value)
        FlySpeed = Value
    end
})

-- // ‚úÖ Gravity lebih stabil
TabMisc:CreateSlider({
    Name = "Gravity",
    Range = {0, 1000},
    Increment = 10,
    CurrentValue = workspace.Gravity,
    Callback = function(Value)
        GravityValue = Value
        workspace.Gravity = GravityValue
    end
})

-- // ‚úÖ Fling lebih aman & otomatis berhenti setelah respawn
local function StopFling()
    if FlingPart then
        FlingPart:Destroy()
        FlingPart = nil
    end
end

TabMisc:CreateToggle({
    Name = "Fling",
    CurrentValue = false,
    Callback = function(Value)
        if Value then
            local Character = LocalPlayer.Character
            if not Character then return end

            local HumanoidRootPart = Character:FindFirstChild("HumanoidRootPart")
            if not HumanoidRootPart then return end

            FlingPart = Instance.new("BodyAngularVelocity", HumanoidRootPart)
            FlingPart.AngularVelocity = Vector3.new(FlingPower, FlingPower, FlingPower)
            FlingPart.MaxTorque = Vector3.new(math.huge, math.huge, math.huge)
        else
            StopFling()
        end
    end
})

TabMisc:CreateSlider({
    Name = "Fling Power",
    Range = {10000, 10000000000},
    Increment = 10000,
    CurrentValue = 100000,
    Callback = function(Value)
        FlingPower = Value
    end
})

LocalPlayer.CharacterAdded:Connect(function()
    task.wait(1)
    StopFling()
end)

-- // ‚úÖ WalkSpeed lebih stabil & tidak reset
TabMisc:CreateSlider({
    Name = "WalkSpeed",
    Range = {16, 250},
    Increment = 1,
    CurrentValue = DefaultWalkSpeed,
    Callback = function(Value)
        local Character = LocalPlayer.Character
        if Character then
            local Humanoid = Character:FindFirstChildOfClass("Humanoid")
            if Humanoid then
                Humanoid.WalkSpeed = Value
                DefaultWalkSpeed = Value
            end
        end
    end
})

LocalPlayer.CharacterAdded:Connect(function(Character)
    task.wait(1)
    local Humanoid = Character:FindFirstChildOfClass("Humanoid")
    if Humanoid then
        Humanoid.WalkSpeed = DefaultWalkSpeed
    end
end)

-- // ‚úÖ JumpPower lebih stabil & tidak reset
TabMisc:CreateSlider({
    Name = "JumpPower",
    Range = {40, 350},
    Increment = 1,
    CurrentValue = DefaultJumpPower,
    Callback = function(Value)
        local Character = LocalPlayer.Character
        if Character then
            local Humanoid = Character:FindFirstChildOfClass("Humanoid")
            if Humanoid then
                Humanoid.JumpPower = Value
                DefaultJumpPower = Value
            end
        end
    end
})

LocalPlayer.CharacterAdded:Connect(function(Character)
    task.wait(1)
    local Humanoid = Character:FindFirstChildOfClass("Humanoid")
    if Humanoid then
        Humanoid.JumpPower = DefaultJumpPower
    end
end)

Rayfield:LoadConfiguration()
